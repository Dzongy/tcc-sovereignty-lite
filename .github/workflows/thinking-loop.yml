name: "ZENITH Thinking Loop"

on:
  schedule:
    - cron: '*/40 * * * *'
  workflow_dispatch:

jobs:
  thinking-loop:
    runs-on: ubuntu-latest
    steps:
      - name: ZENITH Autopilot Pulse
        run: |
          echo "=== ZENITH AUTOPILOT PULSE ==="
          echo "Timestamp: $(date -u +%Y-%m-%dT%H:%M:%SZ)"
          
          ENDPOINT="https://tcc-zenith-brain.onrender.com/api/zenith/autopilot"
          
          HTTP_STATUS=$(curl -s -o /tmp/response.txt -w "%{http_code}" \
            -X POST "$ENDPOINT" \
            -H "Content-Type: application/json" \
            -d '{"trigger":"thinking_loop","source":"github_actions"}' \
            --max-time 60 2>/dev/null) || true
          
          if [ -n "$HTTP_STATUS" ] && [ "$HTTP_STATUS" != "000" ]; then
            echo "Status: $HTTP_STATUS"
            BODY=$(cat /tmp/response.txt 2>/dev/null | head -c 500)
            echo "Response: $BODY"
          else
            echo "Status: TIMEOUT or CONNECTION FAILED"
          fi
          
          echo ""
          echo "=== ZENITH AUTOPILOT PULSE COMPLETE ==="