<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>TCC ZENITH Ã¢ÂÂ Sovereignty Command Center</title><style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Courier New',monospace;background:#0a0a0a;color:#0ff;overflow-x:hidden}
#app{max-width:1400px;margin:0 auto;padding:12px}
.header{text-align:center;border:2px solid #0ff;padding:16px;margin-bottom:16px;background:linear-gradient(135deg,#0a0a0a 0%,#1a1a1a 100%);position:relative}
.header h1{font-size:1.8em;letter-spacing:3px;text-shadow:0 0 10px #0ff}
.header .clock{font-size:1em;margin-top:8px;color:#10b981}
.status-bar{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px;margin-bottom:16px}
.status-card{background:#1a1a1a;border:1px solid #333;padding:12px;border-radius:5px}
.status-card h3{color:#10b981;font-size:0.8em;margin-bottom:6px}
.status-card .value{font-size:1em;color:#fff}
.ind{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:4px}
.ind.g{background:#10b981;box-shadow:0 0 5px #10b981}
.ind.r{background:#ef4444;box-shadow:0 0 5px #ef4444}
.ind.y{background:#f59e0b;box-shadow:0 0 5px #f59e0b}
.section{background:#1a1a1a;border:1px solid #333;padding:16px;margin-bottom:12px;border-radius:5px}
.section h2{color:#0ff;font-size:1.2em;margin-bottom:12px;border-bottom:1px solid #333;padding-bottom:8px;cursor:pointer}
.section h3{color:#10b981;font-size:0.95em;margin:12px 0 8px 0}
.list-item{background:#0f0f0f;padding:8px;margin:4px 0;border-left:3px solid #0ff;font-size:0.85em;color:#ccc}
.error{color:#ef4444;padding:8px;background:#2a1a1a;border-left:3px solid #ef4444;font-size:0.85em}
.chat-box{background:#111;border:2px solid #0ff;border-radius:8px;margin-bottom:16px;overflow:hidden}
.chat-header{background:#1a1a1a;padding:12px 16px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}
.chat-header h2{color:#0ff;font-size:1.1em;margin:0;border:0;padding:0}
.chat-header .status-dot{font-size:0.8em;color:#10b981}
.chat-messages{height:300px;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
.chat-msg{max-width:85%;padding:10px 14px;border-radius:12px;font-size:0.9em;line-height:1.4;word-wrap:break-word}
.chat-msg.user{align-self:flex-end;background:#1a3a5c;color:#7dd3fc;border-bottom-right-radius:4px}
.chat-msg.assistant{align-self:flex-start;background:#1a2a1a;color:#86efac;border-bottom-left-radius:4px}
.chat-msg.system{align-self:center;background:#2a2a1a;color:#fbbf24;font-size:0.8em;padding:6px 12px}
.chat-input-row{display:flex;border-top:1px solid #333;background:#0a0a0a}
.chat-input-row input{flex:1;background:transparent;border:none;color:#0ff;padding:14px 16px;font-family:inherit;font-size:0.95em;outline:none}
.chat-input-row input::placeholder{color:#555}
.chat-input-row button{background:#0ff;color:#0a0a0a;border:none;padding:14px 20px;font-family:inherit;font-weight:bold;cursor:pointer;font-size:0.95em}
.chat-input-row button:hover{background:#10b981}
.chat-input-row button:disabled{background:#333;color:#666;cursor:not-allowed}
@media(max-width:600px){
  #app{padding:8px}
  .header h1{font-size:1.3em}
  .chat-messages{height:250px}
  .status-bar{grid-template-columns:repeat(2,1fr)}
}

.memory-panel{background:#1a1a1a;border:2px solid #0ff;padding:16px;margin-bottom:16px;border-radius:5px;position:relative}
.memory-panel h2{color:#0ff;font-size:1.2em;margin-bottom:12px;text-shadow:0 0 8px #0ff;letter-spacing:2px}
.memory-search{width:100%;padding:10px 14px;background:#0a0a0a;border:1px solid #333;color:#0ff;font-family:'Courier New',monospace;font-size:0.9em;border-radius:4px;margin-bottom:12px;outline:none}
.memory-search:focus{border-color:#0ff;box-shadow:0 0 8px rgba(0,255,255,0.3)}
.memory-search::placeholder{color:#555}
.memory-content{max-height:500px;overflow-y:auto;scrollbar-width:thin;scrollbar-color:#0ff #1a1a1a}
.memory-content::-webkit-scrollbar{width:6px}
.memory-content::-webkit-scrollbar-track{background:#0a0a0a}
.memory-content::-webkit-scrollbar-thumb{background:#0ff;border-radius:3px}
.mem-entry{background:#0a0a0a;border:1px solid #333;padding:10px;margin-bottom:8px;border-radius:4px;transition:border-color 0.2s}
.mem-entry:hover{border-color:#0ff}
.mem-entry .mem-key{color:#10b981;font-size:0.85em;font-weight:bold;margin-bottom:4px}
.mem-entry .mem-val{color:#ccc;font-size:0.82em;line-height:1.5;word-break:break-word}
.mem-entry .mem-val .highlight{background:#0ff;color:#000;padding:0 2px;border-radius:2px}
.mem-stats{color:#555;font-size:0.75em;text-align:right;margin-top:8px}
.mem-category{color:#f59e0b;font-size:0.9em;font-weight:bold;margin:12px 0 6px;padding-bottom:4px;border-bottom:1px solid #333}
.mem-empty{color:#555;font-style:italic;padding:20px;text-align:center}
.mem-loading{color:#0ff;text-align:center;padding:20px;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
</style></head><body><div id="app">

<div class="chat-box">
  <div class="chat-header">
    <h2>ZENITH COMMAND</h2>
    <span class="status-dot" id="chat-status">Ã¢ÂÂ ONLINE</span>
  </div>
  <div class="chat-messages" id="chat-messages">
    <div class="chat-msg system">ZENITH Brain v2.2 Ã¢ÂÂ Type a command or question. Amos has full authority.</div>
  </div>
  <div class="chat-input-row">
    <input type="text" id="chat-input" placeholder="Talk to ZENITH..." autocomplete="off">
    <button id="chat-send" onclick="sendChat()">SEND</button>
  </div>
</div>

<div class="header">
  <h1>TCC ZENITH Ã¢ÂÂ SOVEREIGNTY</h1>
  <div class="clock" id="clock"></div>
</div>

<div class="status-bar" id="status-bar"></div>

<div class="section" id="system-section">
  <h2>SYSTEM STATUS</h2>
  <div id="system-content"><div class="list-item">Loading...</div></div>
</div>

<div class="section" id="payments-section">
  <h2>PAYMENTS / REVENUE</h2>
  <div id="payments-content"><div class="list-item">Loading...</div></div>
</div>

<div class="section" id="autonomy-section">
  <h2>AUTONOMY ENGINE</h2>
  <div id="autonomy-content"><div class="list-item">Loading...</div></div>
</div>

<div class="section" id="autopilot-section">
  <h2>AUTOPILOT LOG</h2>
  <div id="autopilot-content"><div class="list-item">Loading...</div></div>
</div>

</div>

<div class="memory-panel" id="memoryPanel">
<h2>&#x1F9E0; ZENITH MEMORY BRIDGE</h2>
<input type="text" class="memory-search" id="memorySearch" placeholder="Search memory... (identity, rules, infrastructure, learnings...)">
<div class="memory-content" id="memoryContent"><div class="mem-loading">Connecting to ZENITH Memory...</div></div>
<div class="mem-stats" id="memoryStats"></div>
</div>
<script>
const BASE='https://api.cosmic-claw.com';
const AUTH='amos-bridge-2026';
let chatHistory=[];

// --- CLOCK ---
function updateClock(){document.getElementById('clock').textContent=new Date().toUTCString()}
setInterval(updateClock,1000);updateClock();

// --- CHAT ---
async function sendChat(){
  const input=document.getElementById('chat-input');
  const msg=input.value.trim();
  if(!msg)return;
  input.value='';
  document.getElementById('chat-send').disabled=true;
  addChatMsg('user',msg);
  chatHistory.push({role:'user',content:msg});
  try{
    const r=await fetch(BASE+'/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:msg,history:chatHistory.slice(-10)})
    });
    if(!r.ok)throw new Error('Status '+r.status);
    const d=await r.json();
    const reply=d.reply||'No response';
    addChatMsg('assistant',reply);
    chatHistory.push({role:'assistant',content:reply});
  }catch(e){
    addChatMsg('system','Connection error: '+e.message+'. Backend may be waking up - try again in 30s.');
  }
  document.getElementById('chat-send').disabled=false;
  document.getElementById('chat-input').focus();
}
function addChatMsg(role,text){
  const el=document.createElement('div');
  el.className='chat-msg '+role;
  el.textContent=text;
  const container=document.getElementById('chat-messages');
  container.appendChild(el);
  container.scrollTop=container.scrollHeight;
}
document.getElementById('chat-input').addEventListener('keydown',function(e){
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat()}
});

// --- DASHBOARD DATA ---
async function fetchDashboard(){
  try{
    const [health,status,zenith,autopilotHist]=await Promise.allSettled([
      fetch(BASE+'/api/health').then(r=>r.json()),
      fetch(BASE+'/api/status',{headers:{'X-Auth':AUTH}}).then(r=>r.json()),
      fetch(BASE+'/api/zenith/status',{headers:{'X-Auth':AUTH}}).then(r=>r.json()),
      fetch(BASE+'/api/zenith/autopilot/history').then(r=>r.json())
    ]);
    const h=health.status==='fulfilled'?health.value:null;
    const s=status.status==='fulfilled'?status.value:null;
    const z=zenith.status==='fulfilled'?zenith.value:null;
    const ap=autopilotHist.status==='fulfilled'?autopilotHist.value:null;
    renderStatusBar(h,s,z);
    renderSystem(h,s,z);
    renderPayments(z);
    renderAutonomy(z);
    renderAutopilot(ap);
    document.getElementById('chat-status').textContent=h?'\u25cf ONLINE':'\u25cf OFFLINE';
    document.getElementById('chat-status').style.color=h?'#10b981':'#ef4444';
  }catch(e){console.error('Dashboard fetch error:',e)}
}

function renderStatusBar(h,s,z){
  const el=document.getElementById('status-bar');
  const online=!!h;
  const mode=z?z.mode:'unknown';
  const ver=z?z.version:(s?s.version:'?');
  const upH=z&&z.uptime?z.uptime.hours.toFixed(1):'?';
  const rev=z&&z.payments?'$'+z.payments.totalRevenue:'$0';
  el.innerHTML=
    '<div class="status-card"><h3>BACKEND</h3><div class="value"><span class="ind '+(online?'g':'r')+'"></span>'+(online?'ONLINE':'OFFLINE')+'</div></div>'+
    '<div class="status-card"><h3>MODE</h3><div class="value">'+mode+'</div></div>'+
    '<div class="status-card"><h3>VERSION</h3><div class="value">'+ver+'</div></div>'+
    '<div class="status-card"><h3>UPTIME</h3><div class="value">'+upH+' hrs</div></div>'+
    '<div class="status-card"><h3>REVENUE</h3><div class="value" style="color:#10b981">'+rev+'</div></div>';
}

function renderSystem(h,s,z){
  const el=document.getElementById('system-content');
  if(!z&&!h){el.innerHTML='<div class="error">System data unavailable</div>';return}
  let html='';
  if(z&&z.health){
    const hd=z.health.details||{};
    html+='<h3>HEALTH CHECKS</h3>';
    Object.entries(hd).forEach(function(kv){
      html+='<div class="list-item"><span class="ind '+(kv[1]?'g':'r')+'"></span><strong>'+kv[0]+':</strong> '+(kv[1]?'OK':'FAIL')+'</div>';
    });
    html+='<div class="list-item">Last check: '+(z.health.lastCheck||'never')+'</div>';
  }
  if(h&&h.pillars){
    html+='<h3>PILLARS</h3>';
    Object.entries(h.pillars).forEach(function(kv){
      html+='<div class="list-item"><span class="ind '+(kv[1]==='ok'?'g':'r')+'"></span>'+kv[0]+': '+kv[1]+'</div>';
    });
  }
  if(z&&z.soulCheck){
    html+='<h3>SOUL CHECK</h3>';
    html+='<div class="list-item">Active: '+(z.soulCheck.active?'YES':'NO')+' | Attempts: '+z.soulCheck.stats.attempts+' | Successes: '+z.soulCheck.stats.successes+' | Failures: '+z.soulCheck.stats.failures+'</div>';
  }
  if(z&&z.endpoints){
    html+='<div class="list-item">Registered endpoints: '+z.endpoints+'</div>';
  }
  el.innerHTML=html||'<div class="list-item">No system data</div>';
}

function renderPayments(z){
  const el=document.getElementById('payments-content');
  if(!z||!z.payments){el.innerHTML='<div class="list-item">No payment data available</div>';return}
  const p=z.payments;
  el.innerHTML=
    '<div class="list-item"><strong>Total Revenue:</strong> $'+p.totalRevenue+'</div>'+
    '<div class="list-item"><strong>Total Payments:</strong> '+p.totalPayments+'</div>'+
    '<div class="list-item"><strong>Recent Count:</strong> '+p.recentCount+'</div>'+
    '<div class="list-item"><strong>Last Payment:</strong> '+(p.lastPayment||'None yet')+'</div>'+
    '<div class="list-item" style="margin-top:8px"><a href="https://buy.stripe.com/14AdR27X6f603ti0BC4wM0P" target="_blank" style="color:#0ff">$97 Checkout Link</a></div>';
}

function renderAutonomy(z){
  const el=document.getElementById('autonomy-content');
  if(!z||!z.autonomy){el.innerHTML='<div class="list-item">Autonomy data unavailable</div>';return}
  const a=z.autonomy;
  el.innerHTML=
    '<div class="list-item"><strong>Tasks Pending:</strong> '+a.tasksPending+'</div>'+
    '<div class="list-item"><strong>Tasks Completed:</strong> '+a.tasksCompleted+'</div>'+
    '<div class="list-item"><strong>Learnings:</strong> '+a.learnings+'</div>';
}

function renderAutopilot(ap){
  const el=document.getElementById('autopilot-content');
  if(!ap||!ap.log){el.innerHTML='<div class="list-item">No autopilot history yet</div>';return}
  let html='<div class="list-item"><strong>Total Cycles:</strong> '+ap.total_cycles+'</div>';
  if(ap.log&&ap.log.length){
    ap.log.slice(-5).reverse().forEach(function(entry){
      const phase=entry.phase||'?';
      const started=entry.startedAt||'?';
      const actions=entry.actions?entry.actions.length:0;
      html+='<div class="list-item"><strong>['+phase.toUpperCase()+']</strong> '+started+' | '+actions+' actions</div>';
    });
  }else{
    html+='<div class="list-item">No cycles logged yet</div>';
  }
  el.innerHTML=html;
}

fetchDashboard();
setInterval(fetchDashboard,60000);


// === ZENITH Memory Bridge ===
let zenithMemoryData = null;
let memorySearchTerm = '';

function flattenMemory(obj, prefix) {
  prefix = prefix || '';
  var entries = [];
  if (!obj || typeof obj !== 'object') return entries;
  var keys = Object.keys(obj);
  for (var i = 0; i < keys.length; i++) {
    var k = keys[i];
    var v = obj[k];
    var path = prefix ? prefix + '.' + k : k;
    if (v && typeof v === 'object' && !Array.isArray(v)) {
      entries = entries.concat(flattenMemory(v, path));
    } else if (Array.isArray(v)) {
      for (var j = 0; j < v.length; j++) {
        if (typeof v[j] === 'object' && v[j] !== null) {
          entries = entries.concat(flattenMemory(v[j], path + '[' + j + ']'));
        } else {
          entries.push({key: path + '[' + j + ']', value: String(v[j])});
        }
      }
    } else {
      entries.push({key: path, value: String(v)});
    }
  }
  return entries;
}

function highlightText(text, term) {
  if (!term) return text;
  var escaped = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  try {
    return text.replace(new RegExp('(' + escaped + ')', 'gi'), '<span class="highlight">$1</span>');
  } catch(e) { return text; }
}

function renderMemory() {
  var el = document.getElementById('memoryContent');
  var statsEl = document.getElementById('memoryStats');
  if (!zenithMemoryData) {
    el.innerHTML = '<div class="mem-empty">No memory data available</div>';
    return;
  }
  var entries = flattenMemory(zenithMemoryData);
  var term = memorySearchTerm.toLowerCase().trim();
  var filtered = entries;
  if (term) {
    filtered = entries.filter(function(e) {
      return e.key.toLowerCase().indexOf(term) !== -1 || e.value.toLowerCase().indexOf(term) !== -1;
    });
  }
  if (filtered.length === 0) {
    el.innerHTML = '<div class="mem-empty">No results for "' + memorySearchTerm + '"</div>';
    statsEl.textContent = '0 / ' + entries.length + ' entries';
    return;
  }
  var categories = {};
  for (var i = 0; i < filtered.length; i++) {
    var cat = filtered[i].key.split('.')[0];
    if (!categories[cat]) categories[cat] = [];
    categories[cat].push(filtered[i]);
  }
  var html = '';
  var catKeys = Object.keys(categories);
  for (var c = 0; c < catKeys.length; c++) {
    var catName = catKeys[c];
    html += '<div class="mem-category">' + catName.toUpperCase() + ' (' + categories[catName].length + ')</div>';
    var items = categories[catName];
    for (var j = 0; j < items.length; j++) {
      var displayKey = items[j].key;
      var displayVal = items[j].value;
      if (displayVal.length > 500) displayVal = displayVal.substring(0, 500) + '...';
      if (term) {
        displayKey = highlightText(displayKey, memorySearchTerm);
        displayVal = highlightText(displayVal, memorySearchTerm);
      }
      html += '<div class="mem-entry"><div class="mem-key">' + displayKey + '</div><div class="mem-val">' + displayVal + '</div></div>';
    }
  }
  el.innerHTML = html;
  statsEl.textContent = filtered.length + ' / ' + entries.length + ' entries | Last refresh: ' + new Date().toLocaleTimeString();
}

function fetchMemory() {
  fetch('https://api.cosmic-claw.com/api/zenith/memory', {headers:{'X-Auth':'amos-bridge-2026'}})
    .then(function(r) { return r.json(); })
    .then(function(data) { zenithMemoryData = data; renderMemory(); })
    .catch(function(e) {
      document.getElementById('memoryContent').innerHTML = '<div class="mem-empty">Memory fetch failed: ' + e.message + '</div>';
    });
}

document.getElementById('memorySearch').addEventListener('input', function(e) {
  memorySearchTerm = e.target.value;
  renderMemory();
});

fetchMemory();
setInterval(fetchMemory, 60000);

</script></body></html>