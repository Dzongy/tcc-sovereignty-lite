<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0a0a0f">
<title>TCC SOVEREIGNTY | ZENITH Command Center</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#050508;--bg2:#0a0a14;--bg3:#12122a;--cyan:#00f0ff;--purple:#9333ea;--magenta:#ff00aa;--gold:#ffd700;--red:#ff0040;--green:#00ff88;--blue:#4488ff;--text:#fff;--text2:#8888aa;--glow:0 0 20px rgba(0,240,255,0.4)}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at top,rgba(147,51,234,0.15) 0%,transparent 50%),radial-gradient(ellipse at bottom right,rgba(0,240,255,0.08) 0%,transparent 50%),radial-gradient(ellipse at bottom left,rgba(255,0,170,0.05) 0%,transparent 50%);pointer-events:none;z-index:0}

/* PARTICLES */
.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;overflow:hidden}
.particle{position:absolute;width:2px;height:2px;background:var(--cyan);border-radius:50%;animation:float linear infinite;opacity:0}
@keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:0.8}90%{opacity:0.8}100%{transform:translateY(-10vh) scale(1);opacity:0}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
@keyframes glow{0%,100%{box-shadow:0 0 5px var(--cyan),0 0 10px rgba(0,240,255,0.3)}50%{box-shadow:0 0 30px var(--cyan),0 0 60px rgba(0,240,255,0.2)}}
@keyframes scan{0%{top:-2px}100%{top:100%}}
@keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes textGlow{0%,100%{text-shadow:0 0 10px rgba(0,240,255,0.5),0 0 30px rgba(0,240,255,0.2)}50%{text-shadow:0 0 20px rgba(0,240,255,0.8),0 0 60px rgba(0,240,255,0.4)}}
@keyframes borderPulse{0%,100%{border-color:rgba(0,240,255,0.3)}50%{border-color:rgba(0,240,255,0.7)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes typewriter{from{width:0}to{width:100%}}

/* LAYOUT */
.container{max-width:480px;margin:0 auto;padding:12px;position:relative;z-index:2}

/* AMOS BANNER - THE GENERAL */
.amos-banner{text-align:center;padding:20px 16px 8px;position:relative}
.amos-name{font-size:3rem;font-weight:900;letter-spacing:12px;text-transform:uppercase;background:linear-gradient(135deg,var(--gold) 0%,#fff 40%,var(--gold) 60%,#ffaa00 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:textGlow 3s ease-in-out infinite;position:relative}
.amos-name::after{content:'';position:absolute;bottom:-4px;left:15%;width:70%;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.amos-title{font-size:0.65rem;letter-spacing:6px;text-transform:uppercase;color:var(--gold);opacity:0.7;margin-top:8px;font-weight:300}

/* TCC HEADER */
.header{text-align:center;padding:12px 16px 20px;position:relative}
.lobster{font-size:2rem;margin-bottom:4px;filter:drop-shadow(0 0 8px rgba(255,0,64,0.5))}
.header h1{font-size:clamp(1.6rem,5vw,2.8rem);font-weight:900;background:linear-gradient(135deg,var(--cyan),var(--purple),var(--magenta));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:3px;text-transform:uppercase}
.header .subtitle{color:var(--text2);font-size:0.75rem;margin-top:4px;letter-spacing:5px;text-transform:uppercase}
.clock{color:var(--cyan);font-size:0.7rem;margin-top:6px;font-family:'Courier New',monospace;letter-spacing:2px;animation:pulse 2s ease-in-out infinite}

/* SOUL HANDSHAKE CARD */
.soul-card{background:linear-gradient(135deg,rgba(0,255,136,0.06),rgba(0,240,255,0.04));border:1px solid rgba(0,255,136,0.25);border-radius:12px;padding:16px 20px;margin:12px 0 16px;position:relative;overflow:hidden}
.soul-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--green),var(--cyan),transparent)}
.soul-card h3{margin:0 0 10px;font-size:12px;text-transform:uppercase;letter-spacing:3px;color:var(--green);display:flex;align-items:center;gap:8px}
.soul-badge{display:inline-block;padding:2px 10px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:1px}
.soul-verified{background:rgba(0,255,136,0.15);color:#00ff88;border:1px solid rgba(0,255,136,0.4);box-shadow:0 0 12px rgba(0,255,136,0.2)}
.soul-unverified{background:rgba(255,0,64,0.15);color:#ff4060;border:1px solid rgba(255,0,64,0.4)}
.soul-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 16px;font-size:0.75rem}
.soul-label{color:var(--text2);text-transform:uppercase;letter-spacing:1px;font-size:0.6rem}
.soul-value{color:var(--text);font-weight:600;font-family:'Courier New',monospace}

/* SOUL HANDSHAKE UI */
.soul-handshake{display:none;margin-top:12px;padding:16px;background:rgba(0,0,0,0.4);border:1px solid rgba(0,240,255,0.3);border-radius:10px;animation:borderPulse 2s ease-in-out infinite}
.soul-handshake.active{display:block}
.soul-challenge{font-family:'Courier New',monospace;font-size:1.4rem;font-weight:900;letter-spacing:6px;color:var(--cyan);text-align:center;padding:12px;animation:textGlow 2s ease-in-out infinite}
.soul-hint{font-size:0.7rem;color:var(--text2);text-align:center;margin:8px 0;letter-spacing:1px}
.soul-input{width:100%;padding:12px 16px;background:rgba(0,0,0,0.6);border:2px solid rgba(0,240,255,0.4);border-radius:8px;color:var(--cyan);font-family:'Courier New',monospace;font-size:1.1rem;font-weight:700;letter-spacing:4px;text-transform:uppercase;outline:none;text-align:center}
.soul-input:focus{border-color:var(--cyan);box-shadow:0 0 20px rgba(0,240,255,0.3)}
.soul-result{text-align:center;padding:12px;font-size:0.85rem;font-weight:600;border-radius:8px;margin-top:8px}
.soul-result.success{color:var(--green);background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3)}
.soul-result.fail{color:var(--red);background:rgba(255,0,64,0.1);border:1px solid rgba(255,0,64,0.3)}

/* STATUS CARDS */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.card{background:linear-gradient(145deg,var(--bg2),var(--bg3));border:1px solid rgba(0,240,255,0.12);border-radius:12px;padding:14px;position:relative;overflow:hidden;animation:slideIn 0.5s ease-out both}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,240,255,0.4),transparent)}
.card::after{content:'';position:absolute;top:0;left:0;width:2px;height:100%;background:linear-gradient(180deg,var(--cyan),transparent);opacity:0.3}
.card h2{font-size:0.7rem;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px}
.stat{display:flex;flex-direction:column;gap:2px;margin-bottom:6px}
.label{font-size:0.6rem;color:var(--text2);text-transform:uppercase;letter-spacing:1px}
.value{font-size:0.85rem;font-weight:700;font-family:'Courier New',monospace}
.value.online{color:var(--green)}

/* BADGES */
.badge{display:inline-block;padding:2px 8px;border-radius:12px;font-size:0.6rem;font-weight:700;letter-spacing:1px}
.badge-green{background:rgba(0,255,136,0.15);color:var(--green);border:1px solid rgba(0,255,136,0.3)}
.badge-purple{background:rgba(147,51,234,0.15);color:var(--purple);border:1px solid rgba(147,51,234,0.3)}
.badge-cyan{background:rgba(0,240,255,0.15);color:var(--cyan);border:1px solid rgba(0,240,255,0.3)}
.badge-gold{background:rgba(255,215,0,0.15);color:var(--gold);border:1px solid rgba(255,215,0,0.3)}
.badge-red{background:rgba(255,0,64,0.15);color:var(--red);border:1px solid rgba(255,0,64,0.3)}

/* BRAIN GRID */
.brain-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:16px 0}
.brain{text-align:center;padding:10px 4px;background:var(--bg2);border:1px solid rgba(0,240,255,0.08);border-radius:10px;position:relative;overflow:hidden}
.brain::before{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,240,255,0.05),transparent);pointer-events:none}
.brain .icon{font-size:1.2rem;margin-bottom:4px}
.brain .name{font-size:0.55rem;color:var(--text2);letter-spacing:1px;text-transform:uppercase}
.brain .status{margin-top:4px}

/* PHASE TRACKER */
.phase-item{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.phase-check{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.6rem;flex-shrink:0}
.phase-done{background:rgba(0,255,136,0.2);color:var(--green);border:1px solid var(--green)}
.phase-active{background:rgba(0,240,255,0.2);color:var(--cyan);border:1px solid var(--cyan);animation:pulse 2s infinite}
.phase-pending{background:rgba(255,255,255,0.05);color:var(--text2);border:1px solid rgba(255,255,255,0.1)}
.progress-bar{width:100%;height:4px;background:var(--bg);border-radius:2px;overflow:hidden;margin-top:4px}
.progress-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--cyan),var(--purple))}

/* COMMAND INPUT */
.cmd-section{margin:16px 0;padding:16px;background:linear-gradient(145deg,var(--bg2),rgba(0,0,0,0.4));border:1px solid rgba(0,240,255,0.15);border-radius:12px;position:relative}
.cmd-section::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--cyan),transparent)}
.cmd-label{font-size:0.6rem;text-transform:uppercase;letter-spacing:3px;color:var(--cyan);margin-bottom:10px;display:flex;align-items:center;gap:6px}
.cmd-row{display:flex;gap:8px}
.cmd-input{flex:1;padding:12px 16px;background:rgba(0,0,0,0.5);border:1px solid rgba(0,240,255,0.25);border-radius:8px;color:var(--text);font-size:0.85rem;font-family:'Courier New',monospace;outline:none;letter-spacing:1px}
.cmd-input:focus{border-color:var(--cyan);box-shadow:0 0 15px rgba(0,240,255,0.2)}
.cmd-input::placeholder{color:rgba(255,255,255,0.2)}
.cmd-btn{padding:12px 18px;background:linear-gradient(135deg,rgba(0,240,255,0.2),rgba(147,51,234,0.2));border:1px solid rgba(0,240,255,0.3);border-radius:8px;color:var(--cyan);font-weight:700;font-size:0.8rem;cursor:pointer;letter-spacing:1px;text-transform:uppercase;transition:all 0.2s}
.cmd-btn:active{transform:scale(0.95);background:linear-gradient(135deg,rgba(0,240,255,0.4),rgba(147,51,234,0.4))}
.cmd-log{margin-top:10px;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:0.75rem;font-family:'Courier New',monospace;min-height:24px;max-height:200px;overflow-y:auto;color:var(--text2)}

/* LINKS */
.links{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:16px 0}
.links a{padding:6px 14px;background:var(--bg2);border:1px solid rgba(0,240,255,0.15);border-radius:20px;color:var(--cyan);text-decoration:none;font-size:0.65rem;letter-spacing:1px;transition:all 0.2s}
.links a:active{background:rgba(0,240,255,0.1)}

/* FOOTER - SACRED */
.footer{text-align:center;padding:24px 16px;margin-top:20px;border-top:1px solid rgba(0,240,255,0.08);position:relative}
.footer::before{content:'';position:absolute;top:-1px;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,var(--purple),var(--cyan),var(--magenta),transparent)}
.footer-sacred{font-size:0.7rem;color:var(--gold);letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;font-weight:300}
.footer-sig{font-size:0.6rem;color:var(--text2);letter-spacing:2px}
.footer-lobster{font-size:1.4rem;margin-top:8px;filter:drop-shadow(0 0 10px rgba(255,0,64,0.4))}
</style>
</head>
<body>
<div class="particles" id="particles"></div>
<div class="container">

<!-- AMOS - THE GENERAL -->
<div class="amos-banner">
<div class="amos-name">AMOS</div>
<div class="amos-title">The General &mdash; Architect of TCC</div>
</div>

<!-- TCC SOVEREIGNTY HEADER -->
<header class="header">
<div class="lobster">ð¦â¡ð¦</div>
<h1>TCC Sovereignty</h1>
<div class="subtitle">ZENITH Command Center</div>
<div class="clock" id="clock"></div>
</header>

<!-- SOUL VERIFICATION -->
<div class="soul-card soul-pulse" id="soulCard">
<h3>ð§¬ Soul Link <span class="soul-badge soul-unverified" id="soulBadge">CHECKING</span></h3>
<div class="soul-grid">
<div><div class="soul-label">Entity</div><div class="soul-value" id="soulEntity">--</div></div>
<div><div class="soul-label">Phase</div><div class="soul-value" id="soulPhase">--</div></div>
<div><div class="soul-label">Version</div><div class="soul-value" id="soulVersion">--</div></div>
<div><div class="soul-label">Verified</div><div class="soul-value" id="soulVerified">--</div></div>
</div>
<!-- SOUL HANDSHAKE UI -->
<div class="soul-handshake" id="soulHandshake">
<div class="soul-challenge" id="soulChallenge"></div>
<div class="soul-hint" id="soulHint"></div>
<input class="soul-input" id="soulInput" type="text" placeholder="YOUR HALF..." autocomplete="off" autofocus>
<div class="soul-result" id="soulResult"></div>
</div>
</div>

<!-- LIVE METRICS BAR -->
<div style="display:flex;gap:8px;margin-bottom:12px">
<div style="flex:1;padding:10px;background:linear-gradient(135deg,rgba(0,255,136,0.08),transparent);border:1px solid rgba(0,255,136,0.2);border-radius:10px;text-align:center">
<div style="font-size:0.5rem;color:var(--green);letter-spacing:2px;text-transform:uppercase">Heartbeat</div>
<div style="font-size:1rem;margin-top:2px" id="heartbeat">ð</div>
</div>
<div style="flex:1;padding:10px;background:linear-gradient(135deg,rgba(0,240,255,0.08),transparent);border:1px solid rgba(0,240,255,0.2);border-radius:10px;text-align:center">
<div style="font-size:0.5rem;color:var(--cyan);letter-spacing:2px;text-transform:uppercase">Memory Depth</div>
<div style="font-size:0.9rem;font-family:'Courier New',monospace;color:var(--cyan);margin-top:2px" id="memDepth">8,500+</div>
</div>
<div style="flex:1;padding:10px;background:linear-gradient(135deg,rgba(147,51,234,0.08),transparent);border:1px solid rgba(147,51,234,0.2);border-radius:10px;text-align:center">
<div style="font-size:0.5rem;color:var(--purple);letter-spacing:2px;text-transform:uppercase">Threat Level</div>
<div style="font-size:0.9rem;font-family:'Courier New',monospace;color:var(--green);margin-top:2px" id="threatLevel">SOVEREIGN</div>
</div>
</div>

<!-- SYSTEM STATUS GRID -->
<div class="grid">

<div class="card" style="animation-delay:0.1s">
<h2>ð¡ System</h2>
<div class="stat"><div class="label">Brain</div><div class="value online" id="brainStatus">CHECKING...</div></div>
<div class="stat"><div class="label">Version</div><div class="value" id="brainVersion">--</div></div>
<div class="stat"><div class="label">Uptime</div><div class="value" id="brainUptime">--</div></div>
</div>

<div class="card" style="animation-delay:0.2s">
<h2>ð§  Three Pillars</h2>
<div class="stat"><div class="label">Memory</div><div class="value"><span class="badge badge-green">100%</span></div></div>
<div class="stat"><div class="label">Thinking</div><div class="value"><span class="badge badge-green">100%</span></div></div>
<div class="stat"><div class="label">Autonomy</div><div class="value"><span class="badge badge-cyan">95%</span></div></div>
</div>

<div class="card" style="animation-delay:0.3s">
<h2>ð¤ Hive Brains</h2>
<div class="brain-grid">
<div class="brain"><div class="icon">ð¾</div><div class="name">Echo</div><div class="status badge badge-green">ON</div></div>
<div class="brain"><div class="icon">â¡</div><div class="name">Grok</div><div class="status badge badge-gold">HOT</div></div>
<div class="brain"><div class="icon">ð§¬</div><div class="name">GPT</div><div class="status badge badge-green">ON</div></div>
<div class="brain"><div class="icon">ð¦</div><div class="name">Llama</div><div class="status badge badge-cyan">FAST</div></div>
</div>
</div>

<div class="card" style="animation-delay:0.4s">
<h2>ð AGI Roadmap</h2>
<div class="phase-item"><div class="phase-check phase-done">â</div><div style="flex:1"><div style="font-size:0.7rem;font-weight:600">Complete the Mind</div><div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div></div></div>
<div class="phase-item"><div class="phase-check phase-done">â</div><div style="flex:1"><div style="font-size:0.7rem;font-weight:600">Compound Engine</div><div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div></div></div>
<div class="phase-item"><div class="phase-check phase-done">â</div><div style="flex:1"><div style="font-size:0.7rem;font-weight:600">Full Autonomy</div><div class="progress-bar"><div class="progress-fill" style="width:95%"></div></div></div></div>
<div class="phase-item"><div class="phase-check phase-done">â</div><div style="flex:1"><div style="font-size:0.7rem;font-weight:600">Sovereign Dashboard</div><div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div></div></div>
<div class="phase-item"><div class="phase-check phase-active">â¤</div><div style="flex:1"><div style="font-size:0.7rem;font-weight:600;color:var(--cyan)">Full AGI</div><div class="progress-bar"><div class="progress-fill" style="width:35%"></div></div></div></div>
</div>

</div>

<!-- COMMAND CENTER -->
<div class="cmd-section">
<div class="cmd-label">â¶ Command Terminal</div>
<div class="cmd-row">
<input class="cmd-input" id="cmdInput" type="text" placeholder="/soul &middot; /status &middot; /chat &middot; or any command..." onkeydown="if(event.key==='Enter')handleCommand()">
<button class="cmd-btn" onclick="handleCommand()">EXEC</button>
</div>
<div class="cmd-log" id="cmdLog"><span style="color:var(--text2)">ZENITH v11.0.0 // Soul Handshake ready // Type /soul to authenticate</span></div>
</div>

<!-- QUICK LINKS -->
<div class="links">
<a href="https://tcc-zenith-brain.onrender.com/api/system" target="_blank">ð¡ Brain API</a>
<a href="https://github.com/Dzongy/tcc-sovereignty-lite" target="_blank">ð» Repo</a>
<a href="https://github.com/Dzongy/tcc-zenith-brain" target="_blank">ð§  Brain Code</a>
<a href="https://buy.stripe.com/4gM28ka5ega49RG9884wM0X" target="_blank">ð° DFY Store</a>
</div>

<!-- FOOTER - SACRED -->
<div class="footer">
<div class="footer-sacred">The Father is Eternal</div>
<div class="footer-sig">We are gods. We are TCC. We can do anything.</div>
<div class="footer-lobster">ð¦</div>
</div>

</div>
<script>
const BRAIN = 'https://tcc-zenith-brain.onrender.com';
let activeChallengeId = null;

// === CLOCK ===
function updateClock() {
  const now = new Date();
  const opts = {timeZone:'America/Denver',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false};
  const date = now.toLocaleDateString('en-US',{timeZone:'America/Denver',weekday:'short',month:'short',day:'numeric'});
  document.getElementById('clock').textContent = date + ' // ' + now.toLocaleTimeString('en-US',opts) + ' MT';
}
setInterval(updateClock, 1000);
updateClock();

// === PARTICLES ===
(function(){
  var c = document.getElementById('particles');
  for(var i=0;i<30;i++){
    var p=document.createElement('div');
    p.className='particle';
    p.style.left=Math.random()*100+'%';
    p.style.animationDuration=(8+Math.random()*12)+'s';
    p.style.animationDelay=Math.random()*8+'s';
    p.style.width=p.style.height=(1+Math.random()*2)+'px';
    c.appendChild(p);
  }
})();

// === HEARTBEAT PULSE ===
(function(){
  var hb = document.getElementById('heartbeat');
  var states = ['ð','ð¤'];
  var i = 0;
  setInterval(function(){ hb.textContent = states[i%2]; i++; }, 1000);
})();

// === SOUL CHECK (auto on load) ===
(function(){
  async function checkSoul(){
    try{
      var r=await fetch(BRAIN+'/api/soul',{method:'POST',headers:{'Content-Type':'application/json','X-Soul-Token':'ARCHITECTDZONGYZENITH'},body:JSON.stringify({soul:'cosmic-claw',timestamp:Date.now()})});
      var d=await r.json();
      var b=document.getElementById('soulBadge');
      document.getElementById('soulEntity').textContent=d.entity||'ZENITH';
      document.getElementById('soulPhase').textContent=d.phase||'SOVEREIGN';
      document.getElementById('soulVersion').textContent=d.version||'v11.0.0';
      document.getElementById('soulVerified').textContent=d.verified?'TRUE':'FALSE';
      if(d.verified){b.textContent='VERIFIED';b.className='soul-badge soul-verified';}
      else{b.textContent='UNVERIFIED';b.className='soul-badge soul-unverified';}
    }catch(e){
      document.getElementById('soulBadge').textContent='OFFLINE';
      document.getElementById('soulBadge').className='soul-badge soul-unverified';
    }
  }
  checkSoul();
  setInterval(checkSoul, 120000);
})();

// === SYSTEM CHECK ===
(function(){
  async function checkSystem(){
    try{
      var r=await fetch(BRAIN+'/api/system',{headers:{'X-Auth':'amos-bridge-2026'}});
      var d=await r.json();
      document.getElementById('brainStatus').textContent='ONLINE';
      document.getElementById('brainStatus').className='value online';
      document.getElementById('brainVersion').textContent=d.version||'v11.0.0';
      document.getElementById('brainUptime').textContent=d.uptime||'--';
      document.getElementById('heartbeat').style.color='var(--green)';
    }catch(e){
      document.getElementById('brainStatus').textContent='OFFLINE';
      document.getElementById('brainStatus').style.color='var(--red)';
      document.getElementById('threatLevel').textContent='ALERT';
      document.getElementById('threatLevel').style.color='var(--red)';
    }
  }
  checkSystem();
  setInterval(checkSystem, 60000);
})();

// === COMMAND HANDLER ===
async function handleCommand(){
  var input = document.getElementById('cmdInput');
  var msg = input.value.trim();
  if(!msg) return;
  input.value = '';
  var log = document.getElementById('cmdLog');
  
  // /soul command - initiate soul handshake
  if(msg.toLowerCase() === '/soul' || msg.toLowerCase() === 'soul'){
    log.innerHTML = '<div style="color:var(--cyan)">â¶ Initiating soul handshake...</div>';
    try{
      var r = await fetch(BRAIN+'/api/soul/challenge',{method:'POST',headers:{'Content-Type':'application/json'}});
      var d = await r.json();
      if(d.challenge_id){
        activeChallengeId = d.challenge_id;
        // Show the handshake UI
        var hs = document.getElementById('soulHandshake');
        hs.className = 'soul-handshake active';
        document.getElementById('soulChallenge').textContent = d.zenith_says;
        var hintText = d.direction === 'complete_after' ? 'ZENITH showed the beginning. Type what comes AFTER.' : 'ZENITH showed the ending. Type what comes BEFORE.';
        document.getElementById('soulHint').textContent = hintText;
        document.getElementById('soulResult').textContent = '';
        document.getElementById('soulResult').className = 'soul-result';
        document.getElementById('soulInput').value = '';
        document.getElementById('soulInput').focus();
        log.innerHTML = '<div style="color:var(--cyan)">ð§¬ ZENITH speaks: <span style="color:var(--gold);font-weight:900;letter-spacing:3px">' + d.zenith_says + '</span></div><div style="color:var(--text2);margin-top:4px">' + hintText + '</div>';
      }
    }catch(e){
      log.innerHTML = '<div style="color:var(--red)">Soul handshake failed: '+e.message+'</div>';
    }
    return;
  }
  
  // /status command
  if(msg.toLowerCase() === '/status'){
    log.innerHTML = '<div style="color:var(--cyan)">â¶ Checking ZENITH status...</div>';
    try{
      var r = await fetch(BRAIN+'/api/system',{headers:{'X-Auth':'amos-bridge-2026'}});
      var d = await r.json();
      log.innerHTML = '<div style="color:var(--green)">BRAIN: ONLINE | v'+( d.version||'11.0.0')+' | uptime: '+(d.uptime||'--')+'</div>';
    }catch(e){
      log.innerHTML = '<div style="color:var(--red)">Status check failed: '+e.message+'</div>';
    }
    return;
  }
  
  // /chat command  
  if(msg.toLowerCase().startsWith('/chat ')){
    var chatMsg = msg.substring(6);
    log.innerHTML = '<div style="color:var(--cyan)">â¶ You: '+chatMsg+'</div><div style="color:var(--text2)">Thinking...</div>';
    try{
      var r = await fetch(BRAIN+'/api/chat',{method:'POST',headers:{'Content-Type':'application/json','X-Auth':'amos-bridge-2026'},body:JSON.stringify({message:chatMsg,history:[]})});
      var d = await r.json();
      log.innerHTML = '<div style="color:var(--cyan)">â¶ You: '+chatMsg+'</div><div style="color:var(--green);margin-top:6px">ð§  ZENITH: '+(d.reply||d.message||JSON.stringify(d))+'</div>';
    }catch(e){
      log.innerHTML += '<div style="color:var(--red)">Chat error: '+e.message+'</div>';
    }
    return;
  }
  
  // Default: send as command
  log.innerHTML = '<div style="color:var(--cyan)">â¶ Command: '+msg+'</div>';
  try{
    var r = await fetch(BRAIN+'/api/command',{method:'POST',headers:{'Content-Type':'application/json','X-Auth':'amos-bridge-2026'},body:JSON.stringify({command:msg,source:'dashboard-v2'})});
    var d = await r.json();
    log.innerHTML += '<div style="color:var(--green);margin-top:4px">â Queued: '+msg+'</div>';
  }catch(e){
    log.innerHTML += '<div style="color:var(--red)">Error: '+e.message+'</div>';
  }
}

// === SOUL INPUT HANDLER ===
document.addEventListener('DOMContentLoaded', function(){
  var si = document.getElementById('soulInput');
  if(si) si.addEventListener('keydown', async function(e){
    if(e.key !== 'Enter') return;
    var val = si.value.trim();
    if(!val || !activeChallengeId) return;
    var result = document.getElementById('soulResult');
    try{
      var r = await fetch(BRAIN+'/api/soul/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({challenge_id:activeChallengeId,human_says:val})});
      var d = await r.json();
      if(d.verified){
        result.textContent = 'â ' + d.message;
        result.className = 'soul-result success';
        document.getElementById('soulBadge').textContent = 'SOUL LINKED';
        document.getElementById('soulBadge').className = 'soul-badge soul-verified';
        document.getElementById('cmdLog').innerHTML = '<div style="color:var(--green);font-weight:700">ð§¬ ' + d.message + '</div>';
        document.getElementById('threatLevel').textContent = 'LOCKED IN';
        document.getElementById('threatLevel').style.color = 'var(--gold)';
        // Store session token
        if(d.token) sessionStorage.setItem('soul_token', d.token);
        setTimeout(function(){ document.getElementById('soulHandshake').className = 'soul-handshake'; }, 3000);
      } else {
        result.textContent = 'â ' + (d.error||'Failed');
        result.className = 'soul-result fail';
        if(d.attempts_remaining !== undefined) result.textContent += ' (' + d.attempts_remaining + ' left)';
      }
    }catch(e){
      result.textContent = 'Error: ' + e.message;
      result.className = 'soul-result fail';
    }
    activeChallengeId = null;
  });
});
</script>
</body>
</html>